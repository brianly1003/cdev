# cdev Configuration
# Copy this file to ~/.cdev/config.yaml and modify as needed

# Server settings
server:
  # Unified port for HTTP API and WebSocket connections
  port: 8766
  host: "127.0.0.1"  # Bind to localhost only (recommended for security)

  # External URL for VS Code port forwarding / tunnels
  # When set, the QR code will contain this URL instead of localhost
  # WebSocket URL is auto-derived (httpsâ†’wss, append /ws)
  # external_url: "https://your-tunnel.devtunnels.ms"

# File watcher settings
watcher:
  enabled: true
  debounce_ms: 100
  ignore_patterns:
    - ".git"
    - "node_modules"
    - ".venv"
    - "venv"
    - "__pycache__"
    - "*.pyc"
    - ".DS_Store"
    - "Thumbs.db"
    - "dist"
    - "build"
    - "coverage"
    - ".next"
    - ".nuxt"
    - "*.log"
    - ".idea"
    - ".vscode"
    - "*.swp"
    - "*.swo"
    - "*~"

# Claude CLI settings
claude:
  command: "claude"  # Path to claude CLI (or just "claude" if in PATH)
  # Base args always included: ["-p", "--verbose", "--output-format", "stream-json"]
  # Note: Do NOT add --input-format stream-json (it expects JSON on stdin, not CLI prompts)
  args: []           # Additional arguments (appended to base args, no duplicates)
  timeout_minutes: 30
  skip_permissions: false  # Set true to add --dangerously-skip-permissions flag

# Git settings
git:
  enabled: true
  command: "git"     # Path to git CLI
  diff_on_change: true  # Auto-generate diff on file change

# Security settings
# IMPORTANT: For production/remote access, keep require_auth: true
security:
  require_auth: true            # Require token authentication for WebSocket and HTTP
  token_expiry_secs: 3600       # How long tokens are valid (default: 1 hour)
  bind_localhost_only: true     # Only accept connections from localhost (recommended)
  allowed_origins: []           # Additional allowed origins for CORS (empty = localhost only)
  # Example for remote access via tunnel:
  # allowed_origins:
  #   - "https://your-app.example.com"
  #   - "*.devtunnels.ms"

  # Rate limiting (recommended for remote access)
  rate_limit:
    enabled: false              # Enable rate limiting
    requests_per_minute: 100    # Max requests per minute per IP

# Logging settings
logging:
  level: "info"      # debug, info, warn, error
  format: "console"  # json, console

  # Log rotation for Claude JSONL logs (.cdev/logs/claude_*.jsonl)
  # Prevents disk exhaustion from long-running sessions
  rotation:
    enabled: true             # Enable log rotation
    max_size_mb: 50           # Rotate when log exceeds this size (MB)
    max_backups: 5            # Keep this many old log files
    max_age_days: 30          # Delete logs older than this (0 = keep forever)
    compress: true            # Gzip rotated log files

# Resource limits
limits:
  max_file_size_kb: 200    # Max file size for get_file command
  max_diff_size_kb: 500    # Max diff size to send
  max_log_buffer: 1000     # Max log lines to buffer
  max_prompt_len: 10000    # Max prompt length

# Mobile pairing settings
pairing:
  show_qr_in_terminal: true   # Display QR code in terminal on startup

# Repository indexer settings
# The indexer creates a SQLite index for fast file search via /api/repository/* endpoints
indexer:
  enabled: true
  # Directories to skip during scanning (customize to your needs)
  # Note: Hidden directories (starting with .) are always skipped
  skip_directories:
    - ".git"
    - ".svn"
    - ".hg"
    - "node_modules"
    - "vendor"
    - "__pycache__"
    - ".pytest_cache"
    - ".mypy_cache"
    - ".tox"
    - ".venv"
    - "venv"
    - ".idea"
    - ".vscode"
    - ".vs"
    - "dist"
    - "target"
    - "coverage"
    - ".coverage"
    - ".nyc_output"
    - ".next"
    - ".nuxt"
    - ".cache"
    - ".parcel-cache"
    - ".turbo"
    # Uncomment to skip build directories:
    # - "build"

# Permission hook bridge settings
# Used for "Allow for Session" functionality when using cdev as a Claude Code hook
permissions:
  session_memory:
    enabled: true             # Enable session memory for permission patterns
    ttl_seconds: 3600         # Idle timeout for remembered patterns (default: 1 hour)
    max_patterns: 100         # Max patterns to remember per session

# Debug and profiling endpoints
# WARNING: Only enable in development or trusted environments
debug:
  enabled: false              # Enable /debug/* endpoints
  pprof_enabled: false        # Enable /debug/pprof/* profiling (when debug is enabled)
