#!/bin/sh
#
# Git hook to prevent commits with Claude Code co-author line
#

COMMIT_MSG_FILE=$1

# Check for Claude Code generated line
if grep -q "Generated with \[Claude Code\]" "$COMMIT_MSG_FILE"; then
    echo "ERROR: Commit message contains Claude Code generated line."
    echo "Please remove the following line from your commit message:"
    echo "  ðŸ¤– Generated with [Claude Code](https://claude.com/claude-code)"
    exit 1
fi

# Check for Claude co-author line
if grep -q "Co-Authored-By: Claude" "$COMMIT_MSG_FILE"; then
    echo "ERROR: Commit message contains Claude co-author line."
    echo "Please remove the Co-Authored-By line from your commit message."
    exit 1
fi

# Run lint before allowing commit
REPO_ROOT=$(git rev-parse --show-toplevel 2>/dev/null || pwd)
echo "Running make lint..."
if ! (cd "$REPO_ROOT" && make lint); then
    echo "ERROR: make lint failed. Commit aborted."
    exit 1
fi

exit 0
